.side-box-row
  %span.rsvp{:class => rsvp_status_class(resource.rsvp)}
    != link_to_remote s_("change RSVP|change"), :url => edit_rsvp_path(resource.email_token), :method => :get
    = resource.rsvp_text

.side-box-row
  - if resource.can_change_number_of_guests?
    %h3= _("Number of Guests")
  - form_for :guest, resource, :builder => TableCellFormBuilder::Builder, :url => rsvp_path(resource.email_token), :html => {:method => :put} do |f|
    - if resource.can_change_number_of_guests?
      != f.text_field :attendees_count, :class => "input-text short", :id => "rsvp_attendees_count"
    %h3= _("Send a message to the host:")
    .textarea-bg
      != text_area_tag "guest[message_to_host]", resource.message_to_host, :id => "guest_message_to_host"
    = _("Note: your message is public")
    .btns-hold.update-rsvp{:style => "display:none"}
      != link_to_function _("save"), "jQuery(this).parents('form').get(0).submit()"
      != link_to_function _("cancel"), "guest_rsvp.cancel()"

:javascript
  var guest_rsvp = {
    attendees_count: #{resource.attendees_count.to_json},
    message_to_host: #{resource.message_to_host.to_json},
    cancel: function() {
      jQuery('#rsvp_attendees_count').val(guest_rsvp.attendees_count);
      jQuery('#guest_message_to_host').val(guest_rsvp.message_to_host);
      jQuery(".btns-hold.update-rsvp").hide();
    }
  };
  jQuery(function(){
    var show_buttons = function(){ jQuery(".btns-hold.update-rsvp").show(); };
    jQuery(".side-box-row input, .side-box-row textarea").focus(show_buttons).click(show_buttons).keyup(show_buttons);
  });